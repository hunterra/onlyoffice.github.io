<!--
 (c) Copyright Ascensio System SIA 2020

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 -->
<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<title>Материалы и цвет</title>
        
    <style>
        label,p {
        font:
            0.8rem 'Fira Sans',
            sans-serif;
        }
        
        legend {
        font: bold 1.1rem 'Fira Sans', sans-serif;
        }
        
        input[type="text"] {
        margin: 0.1rem;
        width: 100%;
        
        }
        
        #hand_meters {
        margin: 0.1rem;
        width: 120px;
        
        }
        
        #back_button {
        margin: 0.2rem;
        
        }
        input[type="submit"] {
        margin: 0.2rem;
        
        }
        
        #ral-ncs-code {
        margin: 0.2rem;
        }
        
        #p_legend {
        font: bold 1.2rem 'Fira Sans', sans-serif;
        }
        
        fieldset {
        border:0 none;
        
        }
        
        ul.hr {
        margin: 0; /* Обнуляем значение отступов */
        padding: 4px; /* Значение полей */
        
        }
        ul.hr li {
        display: inline-block; /* Отображать как строчный элемент */
        vertical-align: top;
        width: 450px;
        }
        
        .text-container {
        
        margin-left: 20px;
        
        }
    </style>
    
    <script>
      var parts_dict = {};
      var status="general";
      var parts_left = 0;

      function handleFormSubmit(formObject) {
        if(status=="general" || status=="custom"){
          var inp_elements = document.getElementsByTagName("input");
          for (let inp in inp_elements){
            if (inp_elements[inp].checked){
              parts_dict[inp_elements[inp].name]=[];
            }
          }
        }
        if(status=="general"){
            parts_left=Object.keys(parts_dict).length
            if (parts_left>0){

                 
            document.body.innerHTML ='<form id="myForm" onsubmit="handleFormRadio(this)"><p id="p_legend"/><ul class="hr"><li><fieldset><legend>Выберите тип поверхности</legend><div><input type="radio" id="tree" name="surface" value="Поверхности со структурой дерева" checked/><label for="tree">Поверхности со структурой дерева</label></div><div><input type="radio" id="smooth" name="surface" value="Поверхности гладкие"/><label for="smooth">Поверхности гладкие</label></div><div><input type="radio" id="notapplicable" name="surface" value="Поверхности не выбираются"/><label for="notapplicable">Поверхности не выбираются <br />(если деталь из металла, стекла или ткани)</label></div></fieldset><fieldset id="field_material"><legend>Выберите материал</legend><div><input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/><label for="mdf">Плита МДФ, покрытая шпоном дуба</label></div><div><input type="radio" id="massiv" name="material" value="Массив дуба"/><label for="massiv">Массив дуба</label></div><div><input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/><label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /><label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label></div></fieldset></li><li><fieldset><legend>Выберите цвет</legend><div><input type="radio" id="nat-dub" name="color" value="Натуральный дуб" checked/><label for="nat-dub">Натуральный дуб</label></div><div><input type="radio" id="lit-dub" name="color" value="Осветлённый дуб"/><label for="lit-dub">Осветлённый дуб</label></div><div><input type="radio" id="w-dub" name="color" value="Белёный дуб"/><label for="w-dub">Белёный дуб</label></div><div><input type="radio" id="lit-oreh" name="color" value="Осветлённый пепельный орех"/><label for="lit-oreh">Осветлённый пепельный орех</label></div><div><input type="radio" id="oreh" name="color" value="Пепельный орех"/><label for="oreh">Пепельный орех</label></div><div><input type="radio" id="w-oreh" name="color" value="Светлый орех"/><label for="w-oreh">Светлый орех</label></div><div><input type="radio" id="b-oreh" name="color" value="Тёмный орех"/><label for="b-oreh">Тёмный орех</label></div><div><input type="radio" id="RAL9005" name="color" value="Чёрный RAL9005"/><label for="RAL9005">Чёрный RAL9005</label></div><div><input type="radio" id="RAL9010" name="color" value="Белый RAL9010"/><label for="RAL9010">Белый RAL9010</label></div><div><input type="radio" id="RAL9003" name="color" value="Белый RAL9003 (холодный белый)"/><label for="RAL9003">Белый RAL9003 (холодный белый)</label></div><div><input type="radio" id="custom-code" name="color" value="custom-code"/><label for="custom-code">Указать код цвета вручную (RAL или NCS)</label><br /><input type="text" id="ral-ncs-code" name="ral-ncs-code"/></div><div><input type="radio" id="b-metal" name="color" value="Чёрный (для металла)"/><label for="b-metal">Чёрный (для металла)</label></div><div><input type="radio" id="w-metal" name="color" value="Белый (для металла)"/><label for="w-metal">Белый (для металла)</label></div></fieldset></li></ul><input type="submit" value="Далее"/><button name="back_button" id="back_button" onclick="buttonFunction()">В начало</button></form>';
            var part=Object.keys(parts_dict)[0]
            if (part=="столешница"){
                document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend>  <div>  <input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/> <label for="mdf">Плита МДФ, покрытая шпоном дуба</label>  </div>  <div>  <input type="radio" id="massiv" name="material" value="Массив дуба"/>  <label for="massiv">Массив дуба</label>  </div>  <div> <input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/> <label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /> <label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label> </div> <div>  <input type="radio" id="mdf_shpon" name="material" value="Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)"/> <label for="mdf_shpon">Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)</label> </div>';
            }
            document.getElementById("p_legend").innerHTML="Конфигурация элемента \""+ part + "\"";
            var div = document.createElement("div");
            div.setAttribute("name", part);
            div.setAttribute("id", "appendedDiv");
            document.getElementById("myForm").appendChild(div);
            
            var rad = document.getElementsByName("surface");
            rad[0].onclick = function() {
              if (part=="столешница"){
                document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend>  <div>  <input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/> <label for="mdf">Плита МДФ, покрытая шпоном дуба</label>  </div>  <div>  <input type="radio" id="massiv" name="material" value="Массив дуба"/>  <label for="massiv">Массив дуба</label>  </div>  <div> <input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/> <label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /> <label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label> </div> <div>  <input type="radio" id="mdf_shpon" name="material" value="Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)"/> <label for="mdf_shpon">Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)</label> </div>';
              }
              else{
                document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend> <div> <input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/> <label for="mdf">Плита МДФ, покрытая шпоном дуба</label> </div> <div> <input type="radio" id="massiv" name="material" value="Массив дуба"/> <label for="massiv">Массив дуба</label> </div> <div><input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/><label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /><label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label></div>';
              }
            };
            rad[1].onclick = function() {
              document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend> <div> <input type="radio" id="massiv-buka" name="material" value="Массив бука" checked/> <label for="massiv-buka">Массив бука</label> </div> <div> <input type="radio" id="mdf-emal" name="material" value="Плита МДФ, покрытая эмалью"/> <label for="mdf-emal">Плита МДФ, покрытая эмалью</label> </div> <div> <input type="radio" id="mdf-lam" name="material" value="Ламинированная плита МДФ"/> <label for="mdf-lam">Ламинированная плита МДФ</label> </div>';
            };
            rad[2].onclick = function() {
              document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend> <div> <input type="radio" id="porolon" name="material" value="Поролон высокой плотности, ткань обивочная" checked/> <label for="porolon">Поролон высокой плотности, ткань обивочная</label> </div> <div> <input type="radio" id="metal" name="material" value="Металл"/> <label for="metal">Металл</label> </div>';
            };
            var custom_color_inp = document.getElementById("ral-ncs-code");
            custom_color_inp.onclick = function() {
                document.getElementById("custom-code").checked = true;
            };



            status="surface";
            }
            else{
              google.script.run.withSuccessHandler(updateUrl).processForm(parts_dict);
            }
        }

          
        else {
          
        }

      }
      function updateUrl(url) {
        google.script.host.close();
      }
      function buttonFunction() {
        parts_dict = {};
        google.script.run.withSuccessHandler(updateUrl).openDialogMaterial();
      }

      function handleFormRadio(formObject) {
        var div_part = document.getElementById("appendedDiv").getAttribute("name");
        var selected_radio_surface = document.querySelector('input[name="surface"]:checked').nextElementSibling.innerText;
        var selected_radio_material = document.querySelector('input[name="material"]:checked').nextElementSibling.innerText;
        var selected_radio_color = document.querySelector('input[name="color"]:checked')
        if (selected_radio_color.id=="custom-code"){
          selected_radio_color = "RALNCSCODE" + document.getElementById("ral-ncs-code").value
        }
        else {
          selected_radio_color = selected_radio_color.nextElementSibling.innerText;
        }
        
        if(selected_radio_material=="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"){
          selected_radio_material= "Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба (шпон 1,5 мм)"
        }
        
        parts_dict[div_part].push(selected_radio_surface,selected_radio_material,selected_radio_color);
        parts_left=parts_left-1
        if(parts_left>0){
          for (let part in parts_dict){
            if (parts_dict[part].length==0){
              document.body.innerHTML ='<form id="myForm" onsubmit="handleFormRadio(this)"><p id="p_legend"/><ul class="hr"><li><fieldset><legend>Выберите тип поверхности</legend><div><input type="radio" id="tree" name="surface" value="Поверхности со структурой дерева" checked/><label for="tree">Поверхности со структурой дерева</label></div><div><input type="radio" id="smooth" name="surface" value="Поверхности гладкие"/><label for="smooth">Поверхности гладкие</label></div><div><input type="radio" id="notapplicable" name="surface" value="Поверхности не выбираются"/><label for="notapplicable">Поверхности не выбираются</label> <br><label for="notapplicable">(если деталь из металла, стекла или ткани)</label></div></fieldset><fieldset id="field_material"><legend>Выберите материал</legend><div><input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/><label for="mdf">Плита МДФ, покрытая шпоном дуба</label></div><div><input type="radio" id="massiv" name="material" value="Массив дуба"/><label for="massiv">Массив дуба</label></div><div><input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/><label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /><label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label></div></fieldset></li><li><fieldset><legend>Выберите цвет</legend><div><input type="radio" id="nat-dub" name="color" value="Натуральный дуб" checked/><label for="nat-dub">Натуральный дуб</label></div><div><input type="radio" id="lit-dub" name="color" value="Осветлённый дуб"/><label for="lit-dub">Осветлённый дуб</label></div><div><input type="radio" id="w-dub" name="color" value="Белёный дуб"/><label for="w-dub">Белёный дуб</label></div><div><input type="radio" id="lit-oreh" name="color" value="Осветлённый пепельный орех"/><label for="lit-oreh">Осветлённый пепельный орех</label></div><div><input type="radio" id="oreh" name="color" value="Пепельный орех"/><label for="oreh">Пепельный орех</label></div><div><input type="radio" id="w-oreh" name="color" value="Светлый орех"/><label for="w-oreh">Светлый орех</label></div><div><input type="radio" id="b-oreh" name="color" value="Тёмный орех"/><label for="b-oreh">Тёмный орех</label></div><div><input type="radio" id="RAL9005" name="color" value="Чёрный RAL9005"/><label for="RAL9005">Чёрный RAL9005</label></div><div><input type="radio" id="RAL9010" name="color" value="Белый RAL9010"/><label for="RAL9010">Белый RAL9010</label></div><div><input type="radio" id="RAL9003" name="color" value="Белый RAL9003 (холодный белый)"/><label for="RAL9003">Белый RAL9003 (холодный белый)</label></div><div><input type="radio" id="custom-code" name="color" value="custom-code"/><label for="custom-code">Указать код цвета вручную (RAL или NCS)</label><br><input type="text" id="ral-ncs-code" name="ral-ncs-code"/></div><div><input type="radio" id="b-metal" name="color" value="Чёрный (для металла)"/><label for="b-metal">Чёрный (для металла)</label></div><div><input type="radio" id="w-metal" name="color" value="Белый (для металла)"/><label for="w-metal">Белый (для металла)</label></div></fieldset></li></ul><input type="submit" value="Далее"/><button name="back_button" id="back_button" onclick="buttonFunction()">В начало</button></form>';
              if (part=="столешница"){
                document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend>  <div>  <input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/> <label for="mdf">Плита МДФ, покрытая шпоном дуба</label>  </div>  <div>  <input type="radio" id="massiv" name="material" value="Массив дуба"/>  <label for="massiv">Массив дуба</label>  </div>  <div> <input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/> <label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /> <label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label> </div> <div>  <input type="radio" id="mdf_shpon" name="material" value="Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)"/> <label for="mdf_shpon">Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)</label> </div>';
              }
              document.getElementById("p_legend").innerHTML="Конфигурация элемента  \""+part +"\"";
              var div = document.createElement("div");
              div.setAttribute("name", part);
              div.setAttribute("id", "appendedDiv");
              document.getElementById("myForm").appendChild(div);

              var rad = document.getElementsByName("surface");
              rad[0].onclick = function() {
              if (part=="столешница"){
                document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend>  <div>  <input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/> <label for="mdf">Плита МДФ, покрытая шпоном дуба</label>  </div>  <div>  <input type="radio" id="massiv" name="material" value="Массив дуба"/>  <label for="massiv">Массив дуба</label>  </div>  <div> <input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/> <label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /> <label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label> </div> <div>  <input type="radio" id="mdf_shpon" name="material" value="Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)"/> <label for="mdf_shpon">Плита МДФ, покрытая шпоном дуба (шпон 0,6 мм)</label> </div>';
              }
              else{
                document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend> <div> <input type="radio" id="mdf" name="material" value="Плита МДФ, покрытая шпоном дуба" checked/> <label for="mdf">Плита МДФ, покрытая шпоном дуба</label> </div> <div> <input type="radio" id="massiv" name="material" value="Массив дуба"/> <label for="massiv">Массив дуба</label> </div> <div><input type="radio" id="mdf_dub" name="material" value="Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба"/><label for="mdf_dub">Плита МДФ в обкладке из массива дуба, покрытая шпоном дуба</label> <br /><label for="mdf_dub" class="text-container">(шпон 1,5 мм)</label></div>';
              }
              };
              rad[1].onclick = function() {
              document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend> <div> <input type="radio" id="massiv-buka" name="material" value="Массив бука" checked/> <label for="massiv-buka">Массив бука</label> </div> <div> <input type="radio" id="mdf-emal" name="material" value="Плита МДФ, покрытая эмалью"/> <label for="mdf-emal">Плита МДФ, покрытая эмалью</label> </div> <div> <input type="radio" id="mdf-lam" name="material" value="Ламинированная плита МДФ"/> <label for="mdf-lam">Ламинированная плита МДФ</label> </div>';
              };
              rad[2].onclick = function() {
              document.getElementById("field_material").innerHTML='<legend>Выберите материал</legend> <div> <input type="radio" id="porolon" name="material" value="Поролон высокой плотности, ткань обивочная" checked/> <label for="porolon">Поролон высокой плотности, ткань обивочная</label> </div> <div> <input type="radio" id="metal" name="material" value="Металл"/> <label for="metal">Металл</label> </div>';
              };
              var custom_color_inp = document.getElementById("ral-ncs-code");
              custom_color_inp.onclick = function() {
                document.getElementById("custom-code").checked = true;
              };
            }
          }
        }


      }
    </script>

    <script type="text/javascript" src="https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.js"></script>
    <script type="text/javascript" src="https://onlyoffice.github.io/sdkjs-plugins/v1/plugins-ui.js"></script>
    <link rel="stylesheet" href="https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.css">
    <script type="text/javascript" src="scripts/code.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script> 
        $(function(){
        $("#includedContent").load("general-parts.html"); 
        });
    </script> 
		
    </head>
  <body>
        <div id="includedContent"></div>
  </body>
</html>